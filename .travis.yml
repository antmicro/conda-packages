language: c

os:
    - windows
    - osx
    - linux
#dist: trusty
sudo: false
addons:
  apt:
    update: true
    packages:
    - realpath
    - build-essential
    - texinfo

before_install:
 - source $TRAVIS_BUILD_DIR/.travis/common.sh
 - bash $TRAVIS_BUILD_DIR/.travis/fixup-git.sh
 - source $TRAVIS_BUILD_DIR/.travis/common.sh

install:
 - ./.travis/install.sh

env:
  - PACKAGE=vtr                 CONDA_CHANNELS="pkgw-forge,conda-forge"
  - PACKAGE=libxml2
  - PACKAGE=libusb
  - PACKAGE=yosys
  - PACKAGE=nextpnr
  - PACKAGE=openocd
  # XXX riscv32 toolchain: disabled as fails to build
  # PACKAGE=riscv32/binutils
  # verilog tools
  - PACKAGE=icestorm
  - PACKAGE=iverilog
  - PACKAGE=verilator
  - PACKAGE=netlistsvg          CONDA_CHANNELS="conda-forge"
  # SystemVerilog tools
  - PACKAGE=zachjs-sv2v         CONDA_CHANNELS="conda-forge"
  - PACKAGE=odin_II             CONDA_CHANNELS="pkgw-forge,conda-forge"
  - PACKAGE=tree-sitter-verilog
  - PACKAGE=slang               CONDA_CHANNELS="conda-forge"    USE_SYSTEM_GCC_VERSION="8"
  - PACKAGE=moore
  - PACKAGE=surelog             CONDA_CHANNELS="conda-forge"
  - PACKAGE=sv-parser
  - PACKAGE=verible                                             USE_SYSTEM_GCC_VERSION="8"
  # protocol analyzers
  - PACKAGE=sigrok-cli          CONDA_CHANNELS="conda-forge"

jobs:
    exclude:
        - os: windows
          env: PACKAGE=tree-sitter-verilog
        - os: windows
          env: PACKAGE=libusb
        - os: windows
          env: PACKAGE=zachjs-sv2v         CONDA_CHANNELS="conda-forge"
        - os: windows
          env: PACKAGE=verible                                             USE_SYSTEM_GCC_VERSION="8"
        - os: windows
          env: PACKAGE=vtr                 CONDA_CHANNELS="pkgw-forge,conda-forge"
        - os: windows
          env: PACKAGE=yosys
        - os: windows
          env: PACKAGE=libxml2
        - os: windows
          env: PACKAGE=libsub
        - os: windows
          env: PACKAGE=nextpnr
        - os: windows
          env: PACKAGE=openocd
        - os: windows
          env: PACKAGE=icestorm
        - os: windows
          env: PACKAGE=verilator
        - os: windows
          env: PACKAGE=iverilog
        - os: windows
          env: PACKAGE=netlistsvg          CONDA_CHANNELS="conda-forge"
        - os: windows
          env: PACKAGE=odin_II             CONDA_CHANNELS="pkgw-forge,conda-forge"
        - os: windows
          env: PACKAGE=slang               CONDA_CHANNELS="conda-forge"    USE_SYSTEM_GCC_VERSION="8"
        - os: windows
          env: PACKAGE=surelog             CONDA_CHANNELS="conda-forge"
        - os: windows
          env: PACKAGE=sigrok-cli          CONDA_CHANNELS="conda-forge"
        - os: osx
          env: PACKAGE=libusb
        - os: osx
          env: PACKAGE=vtr                 CONDA_CHANNELS="pkgw-forge,conda-forge"
        - os: osx
          env: PACKAGE=yosys
        - os: osx
          env: PACKAGE=libxml2
        - os: osx
          env: PACKAGE=libsub
        - os: osx
          env: PACKAGE=nextpnr
        - os: osx
          env: PACKAGE=openocd
        - os: osx
          env: PACKAGE=icestorm
        - os: osx
          env: PACKAGE=verilator
        - os: osx
          env: PACKAGE=iverilog
        - os: osx
          env: PACKAGE=netlistsvg          CONDA_CHANNELS="conda-forge"
        - os: osx
          env: PACKAGE=odin_II             CONDA_CHANNELS="pkgw-forge,conda-forge"
        - os: osx
          env: PACKAGE=slang               CONDA_CHANNELS="conda-forge"    USE_SYSTEM_GCC_VERSION="8"
        - os: osx
          env: PACKAGE=surelog             CONDA_CHANNELS="conda-forge"
        - os: osx
          env: PACKAGE=sigrok-cli          CONDA_CHANNELS="conda-forge"

script:
  - bash $TRAVIS_BUILD_DIR/.travis/script.sh

after_failure:
  - bash $TRAVIS_BUILD_DIR/.travis/after_failure.sh

after_success:
  - bash $TRAVIS_BUILD_DIR/.travis/after_success.sh
